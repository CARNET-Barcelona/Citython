---
title: "Working with maps"
author: "Manuel Gijón Agudo"
date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output:
  pdf_document:
    toc: yes
    toc_depth: 2
  html_document:
    toc: yes
    toc_depth: 2
    toc_float: yes
lang: en 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

-----------------------------------------------------------

## Loading packages

First, we have to include the requieres packages. In order to work with maps, we explain in this tutorial how to do it with the **ggmap** library and how to add new information using the ggplot2 syntax.

```{r libraries, include=TRUE}
#install.packages('knitr')    # uncomented to intall the library if need it
library(knitr)    # just to generate this tutorial

#install.packages('ggplot2')    # uncomented to intall the library if need it
library(ggplot2)   # for plotting

#install.packages('ggmap')    # uncomented to intall the library if need it
library(ggmap)    # for working with maps
```


## First steeps

Have a simple idea of what is the process that the information is going to do help us to be more efficient.

* First we want to thintk in what we want to obtain. In mose cases it will be a graphic representation of the information, a map in simple words. From this point, we have to think in what is the querey we want to do based in what kind of information we have (see the two next sections).

* Now we have to know what is an **API**. An API is an 'Application Programming Interface' and it is going to be what send us the information. Usually we use Google. **Important**: we must be aware that for a free use the number of queries to the Google API is limited to 2500. A few API servers to mention: OpenStreetMap, Google Maps, Stamen and Naver.

* The information arrive to us, often in an image form.


$$
Query \longrightarrow \boxed{API} \longrightarrow Information
$$

### Getting information from the API

#### Using an adress

The **geocode** function ask the API and returns the coordinates of the point in a data.frame object. It will have two rows, longitude and latitude.

```{r geocode, echo=TRUE}
point <- geocode('Calle Ample 4, Barcelona, España', source = "google")
names(point)      # we can check the names of the returned data.frame object

print(point$lon)
print(point$lat)
```

#### Using a pair of georeferencial information

The backwards function: from a pair (lon, lat) we obtain the direction it keeps.

```{r revgeocode , echo=TRUE}
address <- revgeocode(as.numeric(point))
```

### Getting maps from the API

#### get_map function


#### qmap function

